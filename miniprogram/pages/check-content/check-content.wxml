<view class="container">
  <!-- Search and Filter -->
  <view class="search-section">
    <view class="search-bar">
      <input 
        class="search-input" 
        placeholder="æœç´¢å†…å®¹..." 
        value="{{searchKeyword}}" 
        bindinput="onSearchInput"
        bindconfirm="onSearchConfirm"
      />
      <button class="search-btn" bindtap="onSearchConfirm">æœç´¢</button>
    </view>
    
    <view class="filter-bar">
      <picker 
        bindchange="onLandBlockFilterChange" 
        value="{{landBlockFilterIndex}}" 
        range="{{landBlockFilter}}" 
        range-key="name"
        class="filter-picker"
      >
        <view class="filter-item">
          <text class="filter-text">{{landBlockFilter[landBlockFilterIndex].name}}</text>
        </view>
      </picker>
      
      <picker 
        bindchange="onDateRangeChange" 
        mode="date" 
        value="{{dateRange}}"
        class="filter-picker"
      >
        <view class="filter-item">
          <text class="filter-text">{{dateRange || 'é€‰æ‹©æ—¥æœŸ'}}</text>
        </view>
      </picker>
    </view>
  </view>

  <!-- Content List -->
  <view class="content-list">
    <view 
      class="content-item" 
      wx:for="{{contentList}}" 
      wx:key="id"
      bindtap="onContentItemTap"
      data-id="{{item.id}}"
      data-item="{{item}}"
    >
      <view class="content-header">
        <view class="content-meta">
          <text class="land-block-name">{{item.land_block_name}}</text>
          <text class="content-date">{{item.created_at}}</text>
        </view>
        <view class="content-actions">
          <text class="action-btn" catchtap="editContent" data-id="{{item.id}}">ç¼–è¾‘</text>
          <text class="action-btn delete" catchtap="deleteContent" data-id="{{item.id}}">åˆ é™¤</text>
        </view>
      </view>

      <view class="content-body">
        <text class="content-text" wx:if="{{item.content}}">{{item.content}}</text>
        <view class="content-images" wx:if="{{item.img_url}}">
          <image 
            class="content-image" 
            src="{{item.img_url}}" 
            mode="aspectFill"
            bindtap="previewImage"
            data-url="{{item.img_url}}"
          ></image>
        </view>
      </view>

      <view class="content-analysis" wx:if="{{item.extracted_data}}">
        <view class="analysis-header">
          <text class="analysis-title">AIåˆ†æç»“æœ</text>
          <text class="toggle-btn" bindtap="toggleAnalysis" data-id="{{item.id}}">
            {{item.showAnalysis ? 'æ”¶èµ·' : 'å±•å¼€'}}
          </text>
        </view>
        
        <view class="analysis-content" wx:if="{{item.showAnalysis}}">
          <view class="analysis-item" wx:if="{{item.extracted_data.fertilizers && item.extracted_data.fertilizers.length > 0}}">
            <text class="analysis-label">è‚¥æ–™ä¿¡æ¯:</text>
            <view class="fertilizer-tags">
              <text 
                class="fertilizer-tag" 
                wx:for="{{item.extracted_data.fertilizers}}" 
                wx:key="index"
                wx:for-item="fertilizer"
              >
                {{fertilizer.name}} {{fertilizer.amount}}{{fertilizer.unit}}
              </text>
            </view>
          </view>
          
          <view class="analysis-item" wx:if="{{item.extracted_data.crops}}">
            <text class="analysis-label">ä½œç‰©ä¿¡æ¯:</text>
            <text class="analysis-text">{{item.extracted_data.crops}}</text>
          </view>
          
          <view class="analysis-item" wx:if="{{item.extracted_data.conditions}}">
            <text class="analysis-label">ç¯å¢ƒæ¡ä»¶:</text>
            <text class="analysis-text">{{item.extracted_data.conditions}}</text>
          </view>
          
          <view class="analysis-item" wx:if="{{item.extracted_data.suggestions}}">
            <text class="analysis-label">å»ºè®®:</text>
            <text class="analysis-text">{{item.extracted_data.suggestions}}</text>
          </view>
        </view>
      </view>
    </view>

    <!-- Empty State -->
    <view class="empty-state" wx:if="{{contentList.length === 0 && !loading}}">
      <text class="empty-icon">ğŸŒ±</text>
      <text class="empty-text">æš‚æ— å†…å®¹</text>
      <text class="empty-subtitle">å¿«å»æ·»åŠ ä¸€äº›å†œä¸šä¿¡æ¯å§</text>
      <button class="empty-btn" bindtap="goToAddContent">æ·»åŠ å†…å®¹</button>
    </view>

    <!-- Loading -->
    <view class="loading-more" wx:if="{{loading}}">
      <text>åŠ è½½ä¸­...</text>
    </view>

    <!-- Load More -->
    <view class="load-more" wx:if="{{hasMore && !loading}}" bindtap="loadMoreContent">
      <text>åŠ è½½æ›´å¤š</text>
    </view>
  </view>
</view>

<!-- Edit Modal -->
<view class="modal" wx:if="{{showEditModal}}">
  <view class="modal-content">
    <view class="modal-header">
      <text class="modal-title">ç¼–è¾‘å†…å®¹</text>
      <text class="modal-close" bindtap="hideEditModal">Ã—</text>
    </view>
    <view class="modal-body">
      <view class="form-item">
        <text class="form-label">å†…å®¹</text>
        <textarea 
          class="form-textarea" 
          value="{{editingContent.content}}" 
          bindinput="onEditContentInput"
          auto-height
        ></textarea>
      </view>
      <view class="form-item">
        <text class="form-label">åœ°å—</text>
        <picker 
          bindchange="onEditLandBlockChange" 
          value="{{editingContent.landBlockIndex}}" 
          range="{{landBlocks}}" 
          range-key="name"
        >
          <view class="picker-display">
            <text>{{landBlocks[editingContent.landBlockIndex].name}}</text>
          </view>
        </picker>
      </view>
    </view>
    <view class="modal-footer">
      <button class="btn-cancel" bindtap="hideEditModal">å–æ¶ˆ</button>
      <button class="btn-confirm" bindtap="saveEditContent" loading="{{updating}}">ä¿å­˜</button>
    </view>
  </view>
</view>