<view class="page-container">
  <!-- Header -->
  <view class="header">
    <view class="app-icon">🌾</view>
    <text class="title">创建账号</text>
    <text class="subtitle">{{phoneRequired ? '请先授权获取昵称与手机号后完成注册' : '请先授权获取昵称后完成注册，手机号为可选项'}}</text>
  </view>

  <!-- Form Card -->
  <view class="form-card">

    <!-- WeChat Nickname -->
    <view class="form-group">
      <text class="label">微信昵称 <text class="required">*</text></text>
      <button
        wx:if="{{!profileAuthorized}}"
        class="btn-auth"
        bindtap="onGetProfile"
        disabled="{{loading}}"
      >
        授权获取昵称
      </button>
      <view wx:else class="readonly-box {{!nickname && submitAttempted ? 'input-error' : ''}}">
        <text class="readonly-text">{{nickname}}</text>
      </view>
      <text class="field-hint" wx:if="{{!nickname && submitAttempted}}">*请先授权获取昵称</text>
    </view>

    <view class="divider"></view>

    <!-- WeChat Phone Number -->
    <view class="form-group">
      <text class="label">手机号 <text wx:if="{{phoneRequired}}" class="required">*</text><text wx:else class="optional">（可选）</text></text>
      <button
        wx:if="{{!phoneAuthorized}}"
        class="btn-auth"
        open-type="getPhoneNumber"
        bindgetphonenumber="onGetPhoneNumber"
        disabled="{{loading}}"
      >
        授权获取手机号
      </button>
      <view wx:else class="readonly-box {{phoneRequired && !phoneNumber && submitAttempted ? 'input-error' : ''}}">
        <text class="readonly-text">{{maskedPhoneNumber || phoneNumber}}</text>
      </view>
      <text class="field-hint" wx:if="{{phoneRequired && !phoneNumber && submitAttempted}}">*请先授权获取手机号</text>
    </view>

    <view class="divider"></view>

    <!-- Invitation Code -->
    <view class="form-group">
      <text class="label">邀请码 <text class="required">*</text></text>
      <input
        class="input code-input {{!invitationCode && submitAttempted ? 'input-error' : ''}}"
        placeholder="请输入邀请码"
        placeholder-class="input-placeholder"
        value="{{invitationCode}}"
        bindinput="onInputCode"
        maxlength="32"
        disabled="{{loading}}"
      />
      <text class="field-hint" wx:if="{{!invitationCode && submitAttempted}}">*请输入邀请码</text>
    </view>

  </view>

  <!-- Actions -->
  <view class="actions">
    <button
      class="btn-register"
      bindtap="onRegister"
      loading="{{loading}}"
      disabled="{{loading}}"
    >
      完成注册
    </button>
    <button class="btn-back" bindtap="onBack" disabled="{{loading}}">
      返回登录
    </button>
  </view>

  <!-- Note -->
  <view class="note">
    <text class="note-text">没有邀请码？请联系管理员获取</text>
  </view>
</view>
