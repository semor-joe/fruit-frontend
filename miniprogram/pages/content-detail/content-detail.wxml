<view class="container" wx:if="{{!loading}}">
  <!-- Action Bar (below native nav bar) -->
  <view class="action-bar">
    <text class="action-btn" bindtap="editContent">ç¼–è¾‘</text>
    <text class="action-btn delete" bindtap="deleteContent">åˆ é™¤</text>
  </view>

  <!-- Content Sections -->
  <view class="content-sections">
    <!-- Fertilizer Section -->
    <view class="section-card fertilizer-section">
      <view class="section-header">
        <view class="header-content">
          <view class="header-left-inner">
            <text class="section-icon">ğŸŒ±</text>
            <text class="section-title">è‚¥æ–™ä¿¡æ¯</text>
          </view>
          <view class="fertilizer-summary" wx:if="{{content.total_fertilizer_count > 0}}">
            <text class="summary-badge">{{content.total_fertilizer_count}}ç§</text>
            <text class="summary-total">æ€»è®¡ {{content.total_fertilizer_amount}}kg</text>
          </view>
        </view>
      </view>

      <view class="fertilizer-container" wx:if="{{content.prioritized_fertilizers && content.prioritized_fertilizers.length > 0}}">
        <view class="fertilizer-table">
          <view class="table-header">
            <view class="table-cell header-cell name-col">è‚¥æ–™åç§°</view>
            <view class="table-cell header-cell amount-col">ç”¨é‡</view>
            <view class="table-cell header-cell unit-col">å•ä½</view>
          </view>
          <view class="table-row" wx:for="{{content.prioritized_fertilizers}}" wx:key="index" wx:for-item="fertilizer">
            <view class="table-cell name-cell"><text class="fertilizer-name">{{fertilizer.name}}</text></view>
            <view class="table-cell amount-cell"><text class="fertilizer-amount">{{fertilizer.amount}}</text></view>
            <view class="table-cell unit-cell"><text class="fertilizer-unit">{{fertilizer.unit}}</text></view>
          </view>
        </view>
        <view class="fertilizer-summary-footer">
          <view class="summary-item">
            <text class="summary-label">è‚¥æ–™ç§ç±»:</text>
            <text class="summary-value">{{content.total_fertilizer_count}} ç§</text>
          </view>
          <view class="summary-item total-highlight">
            <text class="summary-label">æ€»ç”¨é‡:</text>
            <text class="summary-value">{{content.total_fertilizer_amount}} kg</text>
          </view>
        </view>
      </view>

      <view class="empty-state" wx:else>
        <view class="empty-icon-text">ğŸ“‹</view>
        <text class="empty-text">æš‚æ— è‚¥æ–™ä¿¡æ¯</text>
        <text class="empty-subtitle">ç­‰å¾…AIåˆ†ææˆ–æ‰‹åŠ¨æ·»åŠ </text>
      </view>
    </view>

    <!-- Info Grid -->
    <view class="info-grid">
      <view class="info-card size-card" wx:if="{{content.fruit_size}}">
        <view class="card-header">
          <text class="card-icon">ğŸ“</text>
          <text class="card-title">æœå®è§„æ ¼</text>
        </view>
        <view class="card-content">
          <text class="size-value">ç›´å¾„{{content.fruit_size}}</text>
        </view>
      </view>

      <view class="info-card date-card">
        <view class="card-header">
          <text class="card-icon">ğŸ“…</text>
          <text class="card-title">è®°å½•ä¿¡æ¯</text>
        </view>
        <view class="card-content date-content">
          <view class="date-row">
            <text class="date-label">åˆ›å»º</text>
            <text class="date-value">{{content.formatted_created_at}}</text>
          </view>
          <view class="date-row" wx:if="{{content.formatted_updated_at}}">
            <text class="date-label">æ›´æ–°</text>
            <text class="date-value">{{content.formatted_updated_at}}</text>
          </view>
          <view class="date-row location-row">
            <text class="date-label">åœ°å—</text>
            <text class="date-value location-value">{{landBlockName}}</text>
          </view>
        </view>
      </view>

      <view class="info-card crop-card" wx:if="{{content.crop_type && content.crop_type !== 'æœªçŸ¥ä½œç‰©'}}">
        <view class="card-header">
          <text class="card-icon">ğŸŒ¾</text>
          <text class="card-title">ä½œç‰©ç±»å‹</text>
        </view>
        <view class="card-content">
          <text class="crop-value">{{content.crop_type}}</text>
        </view>
      </view>
    </view>

    <!-- Description Section -->
    <view class="section-card description-section">
      <view class="section-header">
        <view class="header-content">
          <view class="header-left-inner">
            <text class="section-icon">ğŸ“</text>
            <text class="section-title">è¯¦ç»†æè¿°</text>
          </view>
        </view>
      </view>
      <view class="description-container">
        <view class="primary-content">
          <text class="description-text">{{content.primary_description}}</text>
        </view>
        <view class="secondary-content" wx:if="{{content.secondary_info}}">
          <view class="secondary-header">
            <text class="secondary-icon">ğŸ’¡</text>
            <text class="secondary-title">è¡¥å……ä¿¡æ¯</text>
          </view>
          <text class="secondary-text">{{content.secondary_info}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- Image Section -->
  <view class="section-card image-section" wx:if="{{content.img_url || content.image_url}}">
    <view class="section-header">
      <view class="header-content">
        <view class="header-left-inner">
          <text class="section-icon">ğŸ“·</text>
          <text class="section-title">ç›¸å…³å›¾ç‰‡</text>
        </view>
      </view>
    </view>
    <view class="image-container" style="padding: 0 40rpx 40rpx;">
      <image
        class="main-image"
        src="{{content.img_url || content.image_url}}"
        mode="aspectFill"
        bindtap="previewImage"
      ></image>
      <view class="image-overlay">
        <text class="preview-hint">ç‚¹å‡»æŸ¥çœ‹å¤§å›¾</text>
      </view>
    </view>
  </view>

  <!-- AI Analysis Section -->
  <view class="section-card analysis-section" wx:if="{{content.extracted_data}}">
    <view class="section-header">
      <view class="header-content">
        <view class="header-left-inner">
          <text class="section-icon">ğŸ”¬</text>
          <text class="section-title">AIåˆ†æè¯¦æƒ…</text>
        </view>
        <text class="analysis-badge">æ™ºèƒ½åˆ†æ</text>
      </view>
    </view>
    <view class="analysis-grid">
      <view class="analysis-card full-width" wx:if="{{content.extracted_data.conditions}}">
        <view class="analysis-header">
          <text class="analysis-icon">ğŸŒ¤ï¸</text>
          <text class="analysis-label">ç¯å¢ƒæ¡ä»¶</text>
        </view>
        <text class="analysis-value">{{content.extracted_data.conditions}}</text>
      </view>
      <view class="analysis-card full-width" wx:if="{{content.extracted_data.suggestions}}">
        <view class="analysis-header">
          <text class="analysis-icon">ğŸ’¡</text>
          <text class="analysis-label">ä¸“å®¶å»ºè®®</text>
        </view>
        <text class="analysis-value">{{content.extracted_data.suggestions}}</text>
      </view>
    </view>
  </view>

  <!-- Action Buttons -->
  <view class="action-section">
    <button class="primary-btn share-btn" open-type="share">
      <text class="btn-icon">ğŸ“¤</text>
      <text class="btn-text">åˆ†äº«è®°å½•</text>
    </button>
  </view>
</view>

<!-- Loading -->
<view class="loading-container" wx:if="{{loading}}">
  <text class="loading-text">åŠ è½½ä¸­...</text>
</view>

<!-- Add Fertilizer Dialog -->
<view class="fertilizer-dialog-overlay" wx:if="{{showAddFertilizerDialog}}" bindtap="hideAddFertilizerDialog">
  <view class="fertilizer-dialog-container" catchtap="">
    <view class="fertilizer-dialog-header">
      <text class="dialog-title">æ·»åŠ è‚¥æ–™</text>
      <text class="dialog-close-btn" bindtap="hideAddFertilizerDialog">Ã—</text>
    </view>
    <view class="fertilizer-dialog-body" catchtap="">
      <view class="fertilizer-form-item">
        <text class="form-label">è‚¥æ–™åç§° *</text>
        <input class="form-input" placeholder="ä¾‹å¦‚ï¼šå¤åˆè‚¥NPK 15-15-15" value="{{newFertilizer.name}}" bindinput="onFertilizerNameInput"/>
      </view>
      <view class="fertilizer-form-row">
        <view class="fertilizer-form-item flex-1">
          <text class="form-label">ç”¨é‡ *</text>
          <input class="form-input" placeholder="æ•°é‡" type="digit" value="{{newFertilizer.amount}}" bindinput="onFertilizerAmountInput"/>
        </view>
        <view class="fertilizer-form-item flex-small">
          <text class="form-label">å•ä½</text>
          <picker class="unit-picker" bindchange="onFertilizerUnitChange" range="{{['kg', 'g', 'L', 'ml']}}" catchtap="">
            <view class="unit-picker-display" catchtap=""><text>{{newFertilizer.unit}}</text></view>
          </picker>
        </view>
      </view>
      <view class="fertilizer-form-item">
        <text class="form-label">è‚¥æ–™ç±»å‹</text>
        <input class="form-input" placeholder="ä¾‹å¦‚ï¼šå¤åˆè‚¥ã€æœ‰æœºè‚¥ã€å¶é¢è‚¥" value="{{newFertilizer.type}}" bindinput="onFertilizerTypeInput"/>
      </view>
      <view class="fertilizer-form-item">
        <text class="form-label">NPKæ¯”ä¾‹</text>
        <input class="form-input" placeholder="ä¾‹å¦‚ï¼š15-15-15" value="{{newFertilizer.npk_ratio}}" bindinput="onFertilizerNPKInput"/>
      </view>
    </view>
    <view class="fertilizer-dialog-footer">
      <button class="dialog-btn cancel-btn" bindtap="hideAddFertilizerDialog">å–æ¶ˆ</button>
      <button class="dialog-btn add-btn" bindtap="addFertilizer">æ·»åŠ è‚¥æ–™</button>
    </view>
  </view>
</view>
